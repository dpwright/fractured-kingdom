\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{graphicx}
\usepackage{xcolor}

\usepackage{titling}
\usepackage{lettrine}

\usepackage[copyright]{ccicons}
\usepackage{url}
\usepackage{hyperref}

% Fonts
\usepackage{Royal}
\usepackage{pgothic}
\usepackage{Alegreya}

% Addition of a \subtitle command based on the version of \title
% in the titling packge.
\def\subtitle#1{%
  \gdef\@subtitle{#1}
  \begingroup
    \renewcommand{\thanks}[1]{}
    \renewcommand{\thanksmark}[1]{}
    \renewcommand{\thanksgap}[1]{}
    \protected@xdef\thesubtitle{#1}
  \endgroup}
   \def\@subtitle{}

% Use this instead of \maketitle
\newcommand*{\factionstitle}{\begingroup
\centering
\vspace*{0.08\textheight}
{\pgothfamily\Huge\bfseries \@title}\\[\baselineskip]
{\scshape \@subtitle}\\[\baselineskip]
{\scshape by}\\[\baselineskip]
{\large\scshape \@author}\par
\endgroup}

% Try and handle overfull hboxes
\setlength{\emergencystretch}{2pt}

% Lettrine formatting
\setlength{\DefaultNindent}{0em}
\setcounter{DefaultLines}{3}
\newcommand*\initletter{\Royal}
\renewcommand{\LettrineFontHook}{\initletter}

% Title styling
\usepackage{titlesec}

\titleformat{\part}[display]
  {\thispagestyle{empty}\centering\bfseries\Huge}
  {\Large{\partname} {\thepart}}
  {0pt}
  {}

% Chapter style based on the one from this thread:
%   http://tex.stackexchange.com/questions/165878/width-of-chapter-section-with-titlesec
\newcommand\factionschapformat[1]{%
  \parbox[b]{\dimexpr\textwidth-3em\relax}{\raggedright#1}}
\titleformat{\chapter}[display]
  {\bfseries\Huge}
  {\vspace{-8em}\raggedleft{
    {\color{gray}\rule[-5pt]{2pt}{5cm}}\quad
    {\color{gray}\fontsize{60}{60}\selectfont\thechapter}
    }
  }
  {-2.1em}
  {\factionschapformat}

\titleformat{\subsection}
  {\bfseries\large}
  {}
  {0pt}
  {}
  [\titlerule]

\setcounter{secnumdepth}{0}

% Appendix styling (http://tex.stackexchange.com/questions/37357/no-page-number-on-appendixpage)
\usepackage{appendix}
\let\plainappendixpage\appendixpage
\makeatletter
\renewcommand{\appendixpage}{%
  \begingroup
  \let\ps@plain\ps@empty
  \plainappendixpage
  \endgroup}
\makeatother
